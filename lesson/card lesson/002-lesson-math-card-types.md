using UnityEngine;
using System.Collections.Generic;

/// <summary>
/// บทเรียนที่ 002: การติดตั้งใช้งานประเภทการ์ดสำหรับระบบต่อสู้คณิตศาสตร์
/// LESSON 002: Implementing Card Types for Math Battle System
/// สร้างคลาสสำหรับการ์ดแต่ละประเภทในระบบของคุณ
/// </summary>
public class Lesson002_MathCardTypes : MonoBehaviour
{
    // ========================================
    // การติดตั้งใช้งานการ์ดแต่ละประเภท
    // IMPLEMENTING YOUR CARD TYPES
    // ========================================

    // 1.1 การ์ดตัวเลข - NUMBER CARDS
    // เก็บค่าตัวเลขสำหรับใช้ในสมการคณิตศาสตร์
    public class การ์ดตัวเลข : Card
    {
        public int ค่าตัวเลข;

        public การ์ดตัวเลข(string ชื่อ, string คำอธิบาย, int มานา, int ค่า)
            : base(ชื่อ, คำอธิบาย, มานา, ประเภทการ์ด.ตัวเลข)
        {
            ค่าตัวเลข = ค่า;
        }

        public override void เล่นการ์ด(BattleUnit ผู้ใช้, BattleUnit เป้าหมาย)
        {
            // เพิ่มตัวเลขนี้เข้าไปใน "สมการปัจจุบัน" หรือใช้สร้างความเสียหาย
            ผู้ใช้.เพิ่มตัวเลขเข้าสมการ(ค่าตัวเลข);

            Debug.Log($"{ผู้ใช้.ชื่อหน่วย} เล่น {ชื่อการ์ด} (ค่า: {ค่าตัวเลข})");
        }
    }

    // 1.2 การ์ดสลับสมการ - EQUATION SWITCH CARDS
    // สลับหรือเปลี่ยนแปลงการทำงานของสมการ
    public class การ์ดสลับสมการ : Card
    {
        public string การสลับ; // เช่น "+", "-", "×", "÷"

        public การ์ดสลับสมการ(string ชื่อ, string คำอธิบาย, int มานา, string สลับ)
            : base(ชื่อ, คำอธิบาย, มานา, ประเภทการ์ด.สลับสมการ)
        {
            การสลับ = สลับ;
        }

        public override void เล่นการ์ด(BattleUnit ผู้ใช้, BattleUnit เป้าหมาย)
        {
            // สลับตัวดำเนินการในสมการปัจจุบัน
            ผู้ใช้.เปลี่ยนตัวดำเนินการ(การสลับ);

            Debug.Log($"{ผู้ใช้.ชื่อหน่วย} เล่น {ชื่อการ์ด} - สลับเป็น: {การสลับ}");
        }
    }

    // 1.3 การ์ดตัวดำเนินการ - OPERATOR CARDS
    // ตัวดำเนินการคณิตศาสตร์สำหรับรวมกับตัวเลข
    public class การ์ดตัวดำเนินการ : Card
    {
        public string ตัวดำเนินการ; // "+", "-", "×", "÷"

        public การ์ดตัวดำเนินการ(string ชื่อ, string คำอธิบาย, int มานา, string ตัวดำเนินการ)
            : base(ชื่อ, คำอธิบาย, มานา, ประเภทการ์ด.ตัวดำเนินการ)
        {
            this.ตัวดำเนินการ = ตัวดำเนินการ;
        }

        public override void เล่นการ์ด(BattleUnit ผู้ใช้, BattleUnit เป้าหมาย)
        {
            // ตั้งค่าตัวดำเนินการสำหรับการคำนวณถัดไป
            ผู้ใช้.ตั้งตัวดำเนินการ(ตัวดำเนินการ);

            Debug.Log($"{ผู้ใช้.ชื่อหน่วย} เล่น {ชื่อการ์ด} - ตั้งตัวดำเนินการ: {ตัวดำเนินการ}");
        }
    }

    // 1.4 การ์ดช่วยเหลือ - HELP CARDS
    // การ์ดสนับสนุน เช่น เพิ่ม HP/MP หรือบัฟ
    public class การ์ดช่วยเหลือ : Card
    {
        public int จำนวนรักษา;
        public int จำนวนเพิ่มมานา;
        public bool เป็นบัฟถาวร;

        public การ์ดช่วยเหลือ(string ชื่อ, string คำอธิบาย, int มานา,
                              int รักษา = 0, int เพิ่มมานา = 0, bool บัฟถาวร = false)
            : base(ชื่อ, คำอธิบาย, มานา, ประเภทการ์ด.ช่วยเหลือ)
        {
            จำนวนรักษา = รักษา;
            จำนวนเพิ่มมานา = เพิ่มมานา;
            เป็นบัฟถาวร = บัฟถาวร;
        }

        public override void เล่นการ์ด(BattleUnit ผู้ใช้, BattleUnit เป้าหมาย)
        {
            // รักษาพลังชีวิต
            if (จำนวนรักษา > 0)
            {
                ผู้ใช้.รักษา(จำนวนรักษา);
                Debug.Log($"{ผู้ใช้.ชื่อหน่วย} รักษา {จำนวนรักษา} HP");
            }

            // เพิ่มมานา
            if (จำนวนเพิ่มมานา > 0)
            {
                ผู้ใช้.เพิ่มมานา(จำนวนเพิ่มมานา);
                Debug.Log($"{ผู้ใช้.ชื่อหน่วย} ได้รับมานา {จำนวนเพิ่มมานา} แต้ม");
            }

            // บัฟถาวร (เช่น เพิ่มความแรงถาวร)
            if (เป็นบัฟถาวร)
            {
                ผู้ใช้.เพิ่มพลังถาวร();
                Debug.Log($"{ผู้ใช้.ชื่อหน่วย} ได้รับบัฟถาวร!");
            }
        }
    }

    // 1.5 การ์ดกับดัก - TRAP CARDS
    // การ์ดที่วางกับดักรอให้ศัตรูกระตุ้น
    public class การ์ดกับดัก : Card
    {
        public int ความเสียหายกับดัก;
        public string ประเภทกับดัก;

        public การ์ดกับดัก(string ชื่อ, string คำอธิบาย, int มานา, string ประเภท, int ความเสียหาย)
            : base(ชื่อ, คำอธิบาย, มานา, ประเภทการ์ด.กับดัก)
        {
            ประเภทกับดัก = ประเภท;
            ความเสียหายกับดัก = ความเสียหาย;
        }

        public override void เล่นการ์ด(BattleUnit ผู้ใช้, BattleUnit เป้าหมาย)
        {
            // วางกับดักไว้ที่ผู้ใช้ (จะทำงานเมื่อศัตรูโจมตี)
            ผู้ใช้.วางกับดัก(ประเภทกับดัก, ความเสียหายกับดัก);

            Debug.Log($"{ผู้ใช้.ชื่อหน่วย} วางกับดัก {ชื่อการ์ด} ({ประเภทกับดัก})");
        }
    }

    // ========================================
    // การขยาย BattleUnit สำหรับระบบคณิตศาสตร์
    // EXTENDING BATTLE UNIT FOR MATH SYSTEM
    // ========================================

    public class MathBattleUnit : BattleUnit
    {
        // ตัวแปรสำหรับระบบคณิตศาสตร์
        public List<int> สมการปัจจุบัน = new List<int>(); // เก็บตัวเลขที่เล่นแล้ว
        public string ตัวดำเนินการปัจจุบัน = "+"; // ตัวดำเนินการที่ใช้งานอยู่
        public List<string> กับดักที่วาง = new List<string>(); // กับดักที่วางไว้

        public MathBattleUnit(string ชื่อ, int พลังชีวิต, int มานา, bool ผู้เล่น)
            : base(ชื่อ, พลังชีวิต, มานา, ผู้เล่น) { }

        // เพิ่มตัวเลขเข้าสมการ
        public void เพิ่มตัวเลขเข้าสมการ(int เลข)
        {
            สมการปัจจุบัน.Add(เลข);
            คำนวณผลลัพธ์();
        }

        // เปลี่ยนตัวดำเนินการ
        public void เปลี่ยนตัวดำเนินการ(string ตัวดำเนินการใหม่)
        {
            ตัวดำเนินการปัจจุบัน = ตัวดำเนินการใหม่;
        }

        // ตั้งตัวดำเนินการ
        public void ตั้งตัวดำเนินการ(string ตัวดำเนินการ)
        {
            ตัวดำเนินการปัจจุบัน = ตัวดำเนินการ;
        }

        // คำนวณผลลัพธ์ของสมการ
        private void คำนวณผลลัพธ์()
        {
            if (สมการปัจจุบัน.Count < 2) return;

            int ผลลัพธ์ = สมการปัจจุบัน[0];

            for (int i = 1; i < สมการปัจจุบัน.Count; i++)
            {
                switch (ตัวดำเนินการปัจจุบัน)
                {
                    case "+": ผลลัพธ์ += สมการปัจจุบัน[i]; break;
                    case "-": ผลลัพธ์ -= สมการปัจจุบัน[i]; break;
                    case "×": ผลลัพธ์ *= สมการปัจจุบัน[i]; break;
                    case "÷": ผลลัพธ์ /= สมการปัจจุบัน[i]; break;
                }
            }

            // ใช้ผลลัพธ์สร้างความเสียหายให้ศัตรู
            if (เป็นผู้เล่น && มีศัตรูอยู่)
            {
                // หา BattleManager เพื่อเข้าถึงศัตรู
                // ในทางปฏิบัติ คุณจะต้องส่ง reference มาด้วย
                Debug.Log($"คำนวณได้: {ผลลัพธ์} - สร้างความเสียหายให้ศัตรู!");
            }

            // ล้างสมการหลังคำนวณ
            สมการปัจจุบัน.Clear();
        }

        // การรักษา
        public void รักษา(int จำนวน)
        {
            พลังชีวิตปัจจุบัน += จำนวน;
            if (พลังชีวิตปัจจุบัน > พลังชีวิตสูงสุด)
                พลังชีวิตปัจจุบัน = พลังชีวิตสูงสุด;
        }

        // เพิ่มมานา
        public void เพิ่มมานา(int จำนวน)
        {
            มานาปัจจุบัน += จำนวน;
            if (มานาปัจจุบัน > มานาสูงสุด)
                มานาปัจจุบัน = มานาสูงสุด;
        }

        // เพิ่มพลังถาวร
        public void เพิ่มพลังถาวร()
        {
            // เพิ่มความแรงถาวรให้กับการ์ด
            Debug.Log("ได้รับพลังถาวร!");
        }

        // วางกับดัก
        public void วางกับดัก(string ประเภท, int ความเสียหาย)
        {
            กับดักที่วาง.Add(ประเภท);
        }
    }

    // ========================================
    // ระบบสร้างการ์ด (CARD CREATION SYSTEM)
    // ========================================

    /// <summary>
    /// โรงงานสร้างการ์ด - ทำให้สร้างการ์ดง่ายขึ้น
    /// Card Factory - Makes creating cards easier
    /// </summary>
    public static class CardFactory
    {
        // สร้างการ์ดตัวเลข
        public static Card สร้างการ์ดตัวเลข(string ชื่อ, int มานา, int ค่า)
        {
            return new การ์ดตัวเลข(ชื่อ, $"ตัวเลข {ชื่อ}", มานา, ค่า);
        }

        // สร้างการ์ดสลับสมการ
        public static Card สร้างการ์ดสลับสมการ(string ชื่อ, int มานา, string สลับ)
        {
            return new การ์ดสลับสมการ(ชื่อ, $"สลับเป็น {ชื่อ}", มานา, สลับ);
        }

        // สร้างการ์ดตัวดำเนินการ
        public static Card สร้างการ์ดตัวดำเนินการ(string ชื่อ, int มานา, string ตัวดำเนินการ)
        {
            return new การ์ดตัวดำเนินการ(ชื่อ, $"ตัวดำเนินการ {ชื่อ}", มานา, ตัวดำเนินการ);
        }

        // สร้างการ์ดช่วยเหลือ
        public static Card สร้างการ์ดช่วยเหลือ(string ชื่อ, int มานา, int รักษา = 0, int เพิ่มมานา = 0)
        {
            return new การ์ดช่วยเหลือ(ชื่อ, $"การ์ดช่วยเหลือ {ชื่อ}", มานา, รักษา, เพิ่มมานา);
        }

        // สร้างการ์ดกับดัก
        public static Card สร้างการ์ดกับดัก(string ชื่อ, int มานา, string ประเภท, int ความเสียหาย)
        {
            return new การ์ดกับดัก(ชื่อ, $"กับดัก {ชื่อ}", มานา, ประเภท, ความเสียหาย);
        }
    }

    // ========================================
    // ตัวอย่างการใช้งาน
    // USAGE EXAMPLES
    // ========================================

    void Start()
    {
        Debug.Log("=== บทเรียนที่ 002: การติดตั้งใช้งานประเภทการ์ด ===");
        Debug.Log("=== LESSON 002: Implementing Card Types ===");
        Debug.Log("เรียนรู้การสร้างการ์ดแต่ละประเภทในระบบของคุณ");
        Debug.Log("");

        // สาธิตการสร้างการ์ดด้วย CardFactory
        สาธิตการสร้างการ์ด();
    }

    void สาธิตการสร้างการ์ด()
    {
        Debug.Log("=== การสาธิตการสร้างการ์ด ===");
        Debug.Log("=== Card Creation Demo ===");

        // สร้างการ์ดตัวเลข
        var การ์ดเลข5 = CardFactory.สร้างการ์ดตัวเลข("5", 2, 5);
        var การ์ดเลข10 = CardFactory.สร้างการ์ดตัวเลข("10", 3, 10);

        // สร้างการ์ดตัวดำเนินการ
        var การ์ดบวก = CardFactory.สร้างการ์ดตัวดำเนินการ("+", 1, "+");
        var การ์ดคูณ = CardFactory.สร้างการ์ดตัวดำเนินการ("×", 2, "×");

        // สร้างการ์ดช่วยเหลือ
        var การ์ดฮีล = CardFactory.สร้างการ์ดช่วยเหลือ("รักษา 20", 3, 20, 0);

        // สร้างการ์ดกับดัก
        var การ์ดกับดักไฟ = CardFactory.สร้างการ์ดกับดัก("ไฟลุก", 2, "ไฟ", 15);

        Debug.Log($"สร้างการ์ดแล้ว: {การ์ดเลข5.ชื่อการ์ด} (มานา: {การ์ดเลข5.ค่าใช้มานา})");
        Debug.Log($"สร้างการ์ดแล้ว: {การ์ดบวก.ชื่อการ์ด} (มานา: {การ์ดบวก.ค่าใช้มานา})");
        Debug.Log($"สร้างการ์ดแล้ว: {การ์ดฮีล.ชื่อการ์ด} (มานา: {การ์ดฮีล.ค่าใช้มานา})");
        Debug.Log($"สร้างการ์ดแล้ว: {การ์ดกับดักไฟ.ชื่อการ์ด} (มานา: {การ์ดกับดักไฟ.ค่าใช้มานา})");

        // สาธิตการเล่นการ์ด
        Debug.Log("\n=== การสาธิตการเล่นการ์ด ===");
        Debug.Log("=== Card Playing Demo ===");

        var ผู้เล่น = new MathBattleUnit("นักรบคณิตศาสตร์", 100, 50, true);
        var ศัตรู = new MathBattleUnit("มอนสเตอร์คำนวณ", 80, 30, false);

        // เล่นการ์ดเลข 5
        การ์ดเลข5.เล่นการ์ด(ผู้เล่น, ศัตรู);

        // เล่นการ์ดบวก
        การ์ดบวก.เล่นการ์ด(ผู้เล่น, ศัตรู);

        // เล่นการ์ดเลข 10
        การ์ดเลข10.เล่นการ์ด(ผู้เล่น, ศัตรู);

        // เล่นการ์ดฮีล
        การ์ดฮีล.เล่นการ์ด(ผู้เล่น, ศัตรู);

        Debug.Log("\nบทเรียนนี้สอนการสร้างการ์ดแต่ละประเภทในระบบคณิตศาสตร์ของคุณ");
        Debug.Log("This lesson teaches creating each card type in your math system");
    }
}
